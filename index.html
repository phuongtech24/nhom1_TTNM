<!DOCTYPE html>
<html lang="vi">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ƒê√°nh gi√° v√† nh·∫≠n x√©t</title>
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css"
    integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>

<body>
  <div class="admin-container">
    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
      <nav class="menu">
        <a href="#">Trang ch·ªß</a>
        <div class="dropdown-menu">
          <a href="#" class="dropdown-toggle">Qu·∫£n l√Ω phim ‚ñº</a>
        </div>
        <a href="#">Qu·∫£n l√Ω thanh to√°n ‚ñº</a>
        <a href="#">Qu·∫£n l√Ω t√†i kho·∫£n v√† ng∆∞·ªùi d√πng ‚ñº</a>
        <div class="dropdown-menu">
          <a href="#" class="dropdown-toggle">Qu·∫£n l√Ω ƒë√°nh gi√° v√† nh·∫≠n x√©t ‚ñº</a>
          <div class="dropdown-content">
            <button>Ki·ªÉm duy·ªát nh·∫≠n x√©t</button>
            <button>Nh·∫≠n x√©t ƒë√£ b·ªã x√≥a</button>
          </div>
        </div>
        <a href="#">Qu·∫£n l√Ω b√°o c√°o v√† ph√¢n t√≠ch ‚ñº</a>
      </nav>
    </aside>

    <!-- ƒê√°nh gi√° v√† Nh·∫≠n x√©t -->
    <main class="main-content" id="main-review">
      <div style="position: relative;">
        <i class="fa-solid fa-magnifying-glass"></i>
        <h1>ƒê√°nh gi√° v√† nh·∫≠n x√©t</h1>
      </div>
      <table>
        <thead>
          <tr>
            <th>üë§ Ng∆∞·ªùi d√πng</th>
            <th>üé¨ T√™n phim</th>
            <th>‚≠ê ƒê√°nh gi√°</th>
            <th>üí¨ Nh·∫≠n x√©t</th>
            <th>üìÖ Ng√†y g·ª≠i</th>
            <th>‚öôÔ∏è Thao t√°c</th>
          </tr>
        </thead>
        <tbody id="review-table-body">
        </tbody>
      </table>
    </main>

    <!-- Nh·∫≠n x√©t ƒë√£ b·ªã x√≥a -->
    <main class="main-content" id="main-deleted" style="display:none">
      <div style="position: relative;">
        <i class="fa-solid fa-magnifying-glass"></i>
        <h1>Nh·∫≠n x√©t ƒë√£ b·ªã x√≥a</h1>
      </div>
      <table>
        <thead>
          <tr>
            <th>üë§ Ng∆∞·ªùi d√πng</th>
            <th>üé¨ T√™n phim</th>
            <th>‚≠ê ƒê√°nh gi√°</th>
            <th>üí¨ Nh·∫≠n x√©t</th>
            <th>üìÖ Ng√†y x√≥a</th>
            <th>‚öôÔ∏è Thao t√°c</th>
          </tr>
        </thead>
        <tbody id="deleted-review-table-body">
        </tbody>
      </table>
    </main>
  </div>


  <!-- B·∫£ng filter popup -->
  <div id="filter-modal" style="display:none;">
    <div class="filter-box">
      <h2>Ph√¢n lo·∫°i</h2>
      <hr>
      <form id="filter-form">
        <div class="filter-row">
          <label>Th·ªùi gian</label>
          <input name="date" type="date"/>
        </div>
        <div class="filter-row">
          <label>T√™n phim</label>
          <input name="movie" type="text" placeholder="Parasite"/>
        </div>
        <div class="filter-row">
          <label>ƒê√°nh gi√°</label>
          <select name="rating">
            <option value="">Ch·ªçn</option>
            <option value="5">5‚≠ê</option>
            <option value="4">4‚≠ê</option>
            <option value="3">3‚≠ê</option>
            <option value="2">2‚≠ê</option>
            <option value="1">1‚≠ê</option>
          </select>
        </div>
        <div class="filter-actions">
          <button type="button" id="filter-cancel">H·ªßy</button>
          <button type="submit">X√°c nh·∫≠n</button>
        </div>
      </form>
    </div>
  </div>

  <script>
    // Dropdown sidebar
    document.querySelectorAll('.dropdown-toggle').forEach(toggle => {
      toggle.addEventListener('click', function (e) {
        e.preventDefault();
        const parent = this.parentElement;
        parent.classList.toggle('open');
        // ƒê√≥ng c√°c dropdown kh√°c
        document.querySelectorAll('.dropdown-menu').forEach(menu => {
          if (menu !== parent) menu.classList.remove('open');
        });
      });
    });
    // ƒê√≥ng dropdown khi click ra ngo√†i
    document.addEventListener('click', function (e) {
      if (!e.target.closest('.dropdown-menu')) {
        document.querySelectorAll('.dropdown-menu').forEach(menu => menu.classList.remove('open'));
      }
    });
    // X√°c nh·∫≠n khi b·∫•m n√∫t Duy·ªát
    document.querySelectorAll('button').forEach(btn => {
      if (btn.textContent.trim() === 'Duy·ªát') {
        btn.addEventListener('click', function (e) {
          const confirmed = confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën duy·ªát nh·∫≠n x√©t n√†y?');
          if (!confirmed) {
            e.preventDefault();
            return;
          }
          // Th·ª±c hi·ªán h√†nh ƒë·ªông duy·ªát ·ªü ƒë√¢y n·∫øu c·∫ßn
        });
      }
    });

    // D·ªØ li·ªáu m·∫´u cho b·∫£ng
    const reviews = [
      {
        user: 'hoangminh_96',
        movie: 'The Batman (2022)',
        rating: '‚≠ê‚≠ê‚≠ê‚≠ê‚òÜ',
        rating_num: '4',
        comment: 'Phim c·ª±c k·ª≥ h·∫•p d·∫´n, h√¨nh ·∫£nh ƒë·∫πp v√† √¢m thanh t·ªët.',
        date: '30/05/2025'
      },
      {
        user: 'nguyenthanh07',
        movie: 'Stranger Things - SS4',
        rating: '‚≠ê‚≠ê‚≠ê‚òÜ‚òÜ',
        rating_num: '3',
        comment: 'N·ªôi dung h∆°i k√©o d√†i, nh∆∞ng v·∫´n ·ªïn.',
        date: '29/05/2025'
      },
      {
        user: 'khanhle_04',
        movie: 'Parasite (2019)',
        rating: '‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê',
        rating_num: '5',
        comment: 'Tuy·ªát ph·∫©m, k·ªãch b·∫£n qu√° xu·∫•t s·∫Øc!',
        date: '20/05/2025'
      },
      {
        user: 'tramy_2002',
        movie: 'Money Heist ‚Äì P3',
        rating: '‚≠ê‚≠ê‚≠ê‚òÜ‚òÜ',
        rating_num: '3',
        comment: 'M·∫•t ch·∫•t d·∫ßn so v·ªõi ph·∫ßn ƒë·∫ßu.',
        date: '15/02/2025'
      },
      {
        user: 'ngocanh0210',
        movie: 'Interstellar (2014)',
        rating: '‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê',
        rating_num: '5',
        comment: 'M·ªôt trong nh·ªØng phim vi·ªÖn t∆∞·ªüng hay nh·∫•t!',
        date: '2/03/2025'
      },
      // Th√™m d·ªØ li·ªáu m·∫´u kh√°c n·∫øu mu·ªën
    ];

    // Render d·ªØ li·ªáu v√†o b·∫£ng
    const tbody = document.getElementById('review-table-body');
    tbody.innerHTML = reviews.map(r => `
      <tr>
        <td>${r.user}</td>
        <td>${r.movie}</td>
        <td>${r.rating}</td>
        <td>${r.comment}</td>
        <td>${r.date}</td>
        <td><button class="btn approve">Duy·ªát</button> <button class="btn delete">X√≥a</button></td>
      </tr>
    `).join('');

    // X√°c nh·∫≠n khi b·∫•m n√∫t Duy·ªát (c·∫ßn g√°n l·∫°i sau khi render)
    document.querySelectorAll('.approve').forEach(btn => {
      btn.addEventListener('click', function (e) {
        const confirmed = confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën duy·ªát nh·∫≠n x√©t n√†y?');
        if (!confirmed) {
          e.preventDefault();
          return;
        }
        // ·∫®n d√≤ng ch·ª©a n√∫t Duy·ªát sau khi x√°c nh·∫≠n
        this.closest('tr').style.display = 'none';
      });
    });
    // X√°c nh·∫≠n khi b·∫•m n√∫t X√≥a
    document.querySelectorAll('.delete').forEach(btn => {
      btn.addEventListener('click', function (e) {
        const confirmed = confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a nh·∫≠n x√©t n√†y?');
        if (!confirmed) {
          e.preventDefault();
          return;
        }
        // L·∫•y d·ªØ li·ªáu d√≤ng b·ªã x√≥a
        const row = this.closest('tr');
        const cells = row.querySelectorAll('td');
        const deletedTbody = document.getElementById('deleted-review-table-body');
        // T·∫°o ng√†y x√≥a hi·ªán t·∫°i
        const today = new Date();
        const dateStr = today.getDate().toString().padStart(2, '0') + '/' + (today.getMonth() + 1).toString().padStart(2, '0') + '/' + today.getFullYear();
        // Th√™m d√≤ng m·ªõi v√†o b·∫£ng Nh·∫≠n x√©t ƒë√£ b·ªã x√≥a
        deletedTbody.innerHTML += `
          <tr>
            <td>${cells[0].textContent}</td>
            <td>${cells[1].textContent}</td>
            <td>${cells[2].textContent}</td>
            <td>${cells[3].textContent}</td>
            <td>${dateStr}</td>
            <td><button class="btn restore">Kh√¥i ph·ª•c</button></td>
          </tr>
        `;
        // ·∫®n d√≤ng ch·ª©a n√∫t X√≥a sau khi x√°c nh·∫≠n
        row.style.display = 'none';
      });
    });
    // X√°c nh·∫≠n khi b·∫•m n√∫t Kh√¥i ph·ª•c
    document.addEventListener('click', function (e) {
      if (e.target && e.target.classList.contains('restore')) {
        const confirmed = confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën kh√¥i ph·ª•c nh·∫≠n x√©t n√†y?');
        if (!confirmed) {
          e.preventDefault();
          return;
        }
        // L·∫•y d·ªØ li·ªáu d√≤ng b·ªã kh√¥i ph·ª•c
        const row = e.target.closest('tr');
        const cells = row.querySelectorAll('td');
        const tbody = document.getElementById('review-table-body');
        // Th√™m d√≤ng m·ªõi v√†o b·∫£ng ƒê√°nh gi√° v√† nh·∫≠n x√©t (ng√†y g·ª≠i l·∫•y t·ª´ ng√†y x√≥a)
        tbody.innerHTML += `
          <tr>
            <td>${cells[0].textContent}</td>
            <td>${cells[1].textContent}</td>
            <td>${cells[2].textContent}</td>
            <td>${cells[3].textContent}</td>
            <td>${cells[4].textContent}</td>
            <td><button class="btn approve">Duy·ªát</button> <button class="btn delete">X√≥a</button></td>
          </tr>
        `;
        // X√≥a d√≤ng kh·ªèi b·∫£ng Nh·∫≠n x√©t ƒë√£ b·ªã x√≥a
        row.remove();
        // G√°n l·∫°i s·ª± ki·ªán cho c√°c n√∫t m·ªõi th√™m
        rebindApproveDeleteEvents();
      }
    });

    // H√†m g√°n l·∫°i s·ª± ki·ªán cho c√°c n√∫t Duy·ªát v√† X√≥a m·ªõi th√™m
    function rebindApproveDeleteEvents() {
      document.querySelectorAll('.approve').forEach(btn => {
        if (!btn.dataset.bound) {
          btn.addEventListener('click', function (e) {
            const confirmed = confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën duy·ªát nh·∫≠n x√©t n√†y?');
            if (!confirmed) {
              e.preventDefault();
              return;
            }
            this.closest('tr').style.display = 'none';
          });
          btn.dataset.bound = 'true';
        }
      });
      document.querySelectorAll('.delete').forEach(btn => {
        if (!btn.dataset.bound) {
          btn.addEventListener('click', function (e) {
            const confirmed = confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a nh·∫≠n x√©t n√†y?');
            if (!confirmed) {
              e.preventDefault();
              return;
            }
            const row = this.closest('tr');
            const cells = row.querySelectorAll('td');
            const deletedTbody = document.getElementById('deleted-review-table-body');
            const today = new Date();
            const dateStr = today.getDate().toString().padStart(2, '0') + '/' + (today.getMonth() + 1).toString().padStart(2, '0') + '/' + today.getFullYear();
            deletedTbody.innerHTML += `
              <tr>
                <td>${cells[0].textContent}</td>
                <td>${cells[1].textContent}</td>
                <td>${cells[2].textContent}</td>
                <td>${cells[3].textContent}</td>
                <td>${dateStr}</td>
                <td><button class="btn restore">Kh√¥i ph·ª•c</button></td>
              </tr>
            `;
            row.style.display = 'none';
          });
          btn.dataset.bound = 'true';
        }
      });
    }
    // Th√™m s·ª± ki·ªán cho 2 n√∫t chuy·ªÉn tab main
    const btns = document.querySelectorAll('.dropdown-content button');
    const mainReview = document.getElementById('main-review');
    const mainDeleted = document.getElementById('main-deleted');
    if (btns.length >= 2) {
      // ƒê·∫∑t m·∫∑c ƒë·ªãnh active cho n√∫t ƒë·∫ßu ti√™n khi load trang
      btns[0].classList.add('active');
      btns[0].addEventListener('click', function () {
        mainReview.style.display = '';
        mainDeleted.style.display = 'none';
        btns[0].classList.add('active');
        btns[1].classList.remove('active');
      });
      btns[1].addEventListener('click', function () {
        mainReview.style.display = 'none';
        mainDeleted.style.display = '';
        btns[1].classList.add('active');
        btns[0].classList.remove('active');
      });
    }

    // Hi·ªÉn th·ªã b·∫£ng filter khi b·∫•m icon k√≠nh l√∫p
    document.querySelectorAll('.fa-magnifying-glass').forEach(icon => {
      icon.style.cursor = 'pointer';
      icon.addEventListener('click', function (e) {
        document.getElementById('filter-modal').style.display = 'block';
      });
    });
    // ƒê√≥ng filter khi b·∫•m H·ªßy ho·∫∑c click ra ngo√†i
    document.getElementById('filter-cancel').onclick = function () {
      document.getElementById('filter-modal').style.display = 'none';
    };
    document.getElementById('filter-modal').addEventListener('click', function (e) {
      if (e.target === this) this.style.display = 'none';
    });
    // X·ª≠ l√Ω filter d·ªØ li·ªáu b·∫£ng khi b·∫•m X√°c nh·∫≠n filter
    document.getElementById('filter-form').addEventListener('submit', function (e) {
      e.preventDefault();
      const form = e.target;
      const date = form.date.value;
      const movie = form.movie.value.trim();
      const rating = form.rating.value;
      // N·∫øu c·∫£ 3 tr∆∞·ªùng ƒë·ªÅu r·ªóng th√¨ c·∫£nh b√°o
      if (!date && !movie && !rating) {
        alert('Vui l√≤ng nh·∫≠p √≠t nh·∫•t m·ªôt ƒëi·ªÅu ki·ªán ƒë·ªÉ l·ªçc!');
        return;
      }
      const movieLower = movie.toLowerCase();
      let filterDate = '';
      if (date) {
        const d = new Date(date);
        filterDate = d.getDate().toString().padStart(2, '0') + '/' + (d.getMonth() + 1).toString().padStart(2, '0') + '/' + d.getFullYear();
      }
      const filtered = reviews.filter(r => {
        const matchDate = !filterDate || r.date === filterDate;
        const matchMovie = !movieLower || r.movie.toLowerCase().includes(movieLower);
        const matchRating = !rating || r.rating.replace(/[^0-9]/g, '') === rating;
        return matchDate && matchMovie && matchRating;
      });
      tbody.innerHTML = filtered.map(r => `
        <tr>
          <td>${r.user}</td>
          <td>${r.movie}</td>
          <td>${r.rating}</td>
          <td>${r.comment}</td>
          <td>${r.date}</td>
          <td><button class="btn approve">Duy·ªát</button> <button class="btn delete">X√≥a</button></td>
        </tr>
      `).join('');
      rebindApproveDeleteEvents();
      document.getElementById('filter-modal').style.display = 'none';
    });
  </script>
</body>

</html>